---
title: "Project Report: Cars Crash"
author: "Huy Ngo"
date: "Fall 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
```

```{r load-sas-libraries, echo = F, message = F, warning = F}

library(SASmarkdown)
sas_enginesetup(sashtml=sashtml)

sasexe <- "C:/Program Files/SASHome/SASFoundation/9.4/sas.exe"
sasopts <- "-nosplash -ls 75"

# Linux options (for grading, please leave this in!)
# sasexe <- "/usr/local/SASHome/SASFoundation/9.4/bin/sas_en"
# sasopts <- "-ls 75"
```

```{r, echo=FALSE, message=FALSE, warning=FALSE} 
library(dplyr)
library(readr)
library(ggplot2)
Crash <- read_csv("monroe-county-crash-data2003-to-2015.csv")
```

## Introduction

* Automobiles are an indispensable part of life. Thanks to them that travel, transaction, business, and even medical problems has been improving. But they also carry risks that affect human life. People's need is higher and higher, so the number of vehicles must also increase, which entails many consequences such as traffic congestion and accidents. Every day, with hundreds of millions of car trips moving continuously across the country, the chance that one person might find him/herself get involved in an accident is not small.

* The data use in this project is accidents recorded in Monroe County, Indiana, from 2003 to 2015. There are more than 53.000 observations (accidents reported) and many variables.But I am interested in some certain variables, like:
  - Day/ Month/ Year/ Hour (that accidents occurred). 
  - How many cars involved? (Collision type). 
  - What kind of injuries? 
  - What is the primary reason that causes accidents to happen?  

```{r, engine="sashtml", engine.path=sasexe, engine.opts=sasopts, collectcode = T, error = T, echo=FALSE, message=FALSE, warning=FALSE}
ODS HTML STYLE=HTMLBLUE;
filename dat "monroe-county-crash-data2003-to-2015.csv";
PROC IMPORT DATAFILE = dat OUT = Crash
    DBMS = CSV 
    REPLACE; 
    GETNAMES = YES;
    GUESSINGROWS = 5000;
RUN;
proc print data= Crash (obs=5);
var Year Month Day Hour Collision_Type Injury_Type Primary_Factor;
title 'Table.1. Monroe County Accidents Reported from 2003 to 2015';
run;
```

* Some questions I want to find out through the data include:
  - Which year has the highest rate of accident? On what month? Is that month consistent for all other years? 
  - Is there any specific day (or month, year) with more accidents than the other day (month/ year)? 
  - On that day (month/ year), what is the primary factor that causes the accident? What are the highest injuries? 
  - What can we conclude about driving habit of citizen of Monroe county?
  
> Can you answer any of these questions graphically to identify trends? It's not just single-day results that matter, it's the overall trends of which days are likely to result in more crashes.
  
## Methods

* Find which year has the highest accidents. Call it Result. 1
* Among the years, find the month that has the highest accidents. Call it Result. 2
  - Look at the year found in Result. 1, then, find the month which highest accidents Call it Result. 3. 
  - Compare Result. 3 with Result. 2. Explain.
* Among the years, find the day that has more accidents, identify if it week day or weekend. Call it Result. 4
  - Look at Result. 1 and find which type of day has more accidents. Call it Result. 5. 
  - Compare Result. 5 and Result. 4. Explain.
* Among the years, find the hour (in a 24 hour format) that has the highest accidents. Call it Result. 6
  - Look at Result. 1 and find which hour has the highest accidents. Call it Result. 7
  - Compare Result. 6 and Result. 7. Explain.
* Among the years, find the primary factor that cause accidents. Call it Result. 8
  - Look at Result. 1 and find the primary factor for accidents. Call it Result. 9
  - Compare Result. 8 and Result. 9. Explain.
* Look at the relation between primary factor and number of car involved/ month/ day/ hour. Draw conclusion.

> I think this is a decent strategy, but I would use either graphical exploration or a statistical model (or both) to do the exploration, instead of looking for single days.

```{r}
library(lubridate)
library(stringr)
tmp <- Crash %>%
  mutate(hm = sprintf("%04d", Hour),
         hour = str_sub(hm, 1, 2) %>% parse_number(),
         minute = str_sub(hm, 3, 4) %>% parse_number()) %>%
  mutate(wday = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")[Day],
         wday_dec = Day + hour/24)


ggplot(tmp, aes(x = wday_dec)) + 
  geom_line(stat = "count", aes(y = ..count..))

ggplot(tmp, aes(x = hour, color = wday)) + 
  geom_line(stat = "count", aes(y = ..count..))
```

> Note the lack of bar charts! Also, I would have expected different patterns on Saturday and Sunday, so it's a bit odd that those aren't showing up.

## Results

- The accidents recorded through year by create a frequency table. Then, create a bar graph so we can visualize it.

```{r, engine="sashtml", engine.path=sasexe, engine.opts=sasopts, collectcode = T, error = T, echo=FALSE, message=FALSE, warning=FALSE}
ODS HTML STYLE=HTMLBLUE;
title 'Table.2. Accidents frequency through years';
PROC FREQ DATA=Crash;
    TABLE Year;
output out = YE;
RUN;
Proc print data = YE;
run;
```

> Bar charts aren't the best way to visualize temporal data! You can also use line charts, and even create lines by day!

- From the table above, we see that the year which highest cases reported is 2003 (4625 cases). We then look at the number of accidents month by month in that year only

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Month<-filter(Crash, Year == "2003")
MO<-table(Month$Month)
MO
```

- October has the most accidents reported (477). Next we will compare with the "total" accidents reported from 2003 to 2015, month by months:

```{r, echo=FALSE, message=FALSE, warning=FALSE, figures-side, fig.show="hold", out.width="50%"}
ggplot(Month, aes(x = Month)) + 
  geom_bar(fill="steelblue")+
  geom_text(aes(Month, 600, label=Month))+
  ggtitle("Fig. 1. Accidents in 2003, month by month") +
  theme_minimal()

ggplot(Crash, aes(x=Month))+
  geom_bar(fill="steelblue")+
  geom_text(aes(Month, 6000, label=Month))+
  ggtitle("Fig. 2. Accidents from 2003 to 2015, month by month") +
  theme_minimal()
```

> You could use the latitude and longitude to animate the accidents as they happen, if you wanted to do so. That might be pretty cool to see, and there are some awesome animation/gif packages that work nicely with e.g. ggplot2.



```{r, engine="sashtml", engine.path=sasexe, engine.opts=sasopts, collectcode = T, error = T, echo=FALSE, message=FALSE, warning=FALSE}
ODS HTML STYLE=HTMLBLUE;
filename dat "monroe-county-crash-data2003-to-2015.csv";
PROC IMPORT DATAFILE = dat OUT = Crash
    DBMS = CSV 
    REPLACE; 
    GETNAMES = YES;
    GUESSINGROWS = 5000;
RUN;

```



## Conclusion
