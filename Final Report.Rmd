---
title: "Project Report: Cars Crash"
author: "Huy Ngo"
date: "Fall 2020"
output:
  pagedown::html_paged:
    toc: false
    # change to true for a self-contained document, but it'll be a litte slower for Pandoc to render
    self_contained: false
# uncomment this line to produce HTML and PDF in RStudio:
#knit: pagedown::chrome_print
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F, fig.width = 8, fig.height = 7, out.width = "100%", cache = T)
options(digits = 3)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE} 
library(dplyr)
library(readr)
library(ggplot2)
library(plotly)
library(forcats)
Crash <- read_csv("monroe-county-crash-data2003-to-2015.csv")
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(lubridate)
library(dplyr)
library(stringr)
library(plotly)
tmp <- Crash %>%
  mutate(hm = sprintf("%04d", Hour),
         hour = str_sub(hm, 1, 2) %>% parse_number(),
         minute = str_sub(hm, 3, 4) %>% parse_number()) %>%
  mutate(wday = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")[Day],
         wday_dec = Day + hour/24)
```

## Introduction

Automobiles are an indispensable part of life. Thanks to them that travel, transaction, business, and even medical problems has been improving. But they also carry risks that affect human life. People's need is higher and higher, so the number of vehicles must also increase, which entails many consequences such as traffic congestion and accidents. Every day, with hundreds of millions of car trips moving continuously across the country, the chance that one person might find him/herself get involved in an accident is not small.

Monroe County is part of the Bloomington, Indiana. It was formed in 1818 from portions of Orange County, and named after the fifth President of the United States, James Monroe. The 2010 United States Census report that the population was 137,974, the total area is 411.32 square miles (1,065.3 km2), of which 394.51 square miles (1,021.8 km2) (or 95.91%) is land and 16.81 square miles (43.5 km2) (or 4.09%) is water. The county terrain is low rolling hills, covered with vegetation and largely devoted to agricultural use or urban development. [1] 

The data use in this project is accidents reported in Monroe County from 2003 to 2015. There are more than 53.000 observations (cases reported) and many variables, like:

+ Day/ Month/ Year/ Hour (that accidents occurred). 
+ Collision type: Type of vehicles involved?  
+ Injury Types: Fatal, incapacitating, no injury/ unknown, and non-incapacitating.
+ Primary factors that cause accidents: Following too closely, unsafe backing, etc.
 

Some questions I want to find out through the data:

  - Which year has the highest rate of accident? On what month? Is that month consistent for all other years? 
  - Is there any specific day (or month, year) with more accidents than the other day (month/ year)? 
  - On that day (month/ year), what is the primary factor that causes the accident? What are the highest injuries? 
  - What can we conclude about driving habit of citizen of Monroe county?
  
## Methods

Comparing the overall with specific years to find the "trend" of accidents.

* Find the year that has the most accidents occurred. Call it Result. 1
* Among the years, find the month that has the highest accidents. Call it Result. 2
  - Look at the year found in Result. 1, then, find the month has the most accidents. Call it Result. 3. 
  - Compare Result. 3 with Result. 2. 
* Among the years, look at the day with most accidents, identify if it weekday or weekend. Call it Result. 4
  - Look at the Result. 1 and find which type of day has more accidents. Call it Result. 5. 
  - Compare Result. 5 and Result. 4. 
* Among the years, find the hour (in a 24-hour format) with the highest accidents. Call it Result. 6
  - Look at Result. 1 and find which hour has the most accidents. Call it Result. 7
  - Compare Result. 6 and Result. 7. 
* Among the years, look for the primary factor that causes accidents. Call it Result. 8
  - Look at Result. 1 and find the primary factor for accidents. Call it Result. 9
  - Compare Result. 8 and Result. 9. 
* Repeat the same process, but with the year that has lowest cases.
* Look at the relationship between all the factors above. Draw conclusion.


## Results

Consider a table below:

```{r, error = T, echo=FALSE, message=FALSE, warning=FALSE, results='markup'}
library(ggplot2)
Count<-table(tmp$Year)
knitr::kable(Count)
```

We see that 2003 was the year with the highest number of accidents (4625 cases) when 2011 has the lowest cases (3914). The first thing we did is compare 2003 with the overall years. After we found the trend, we will compare 2011 with the overall to verify our assumptio


```{r, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(tmp, aes(x = Month)) + 
  geom_line(stat = "count", aes(y = ..count..))+
  geom_text(aes(Month, 6000, label=Month))+
  ggtitle("Figure 1. Accidents month by month, 2003 to 2015") +
  theme_minimal()

```

In Figure 1., we see the number of accidents peaking at two months: April and October. The peak in October is higher, indicate that month has the most accidents. From now we assume the trend "months of accidents" are April and October. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Month<-filter(tmp, Year == "2003")
ggplot(Month, aes(x = Month)) + 
  geom_line(stat = "count", aes(y = ..count..))+
  geom_text(aes(Month, 600, label=Month))+
  ggtitle("Figure 2. Accidents month by month, 2003") +
  theme_minimal()
```

In Figure 2. we consider the year 2003 only, and we find that October is still the month with the most accidents. The 2nd place is not April but instead, February. So the "trend" is not working for 2003. 


```{r, echo=FALSE, message=FALSE, warning=FALSE, figures-side, fig.show="hold", out.width="70%"}

ggplot(tmp, aes(x = wday)) + 
  geom_bar(fill="brown")+
  ggtitle("Figure 3. Accidents day by day, 2003 to 2015") +
  theme_minimal()

ggplot(Month, aes(x = wday)) + 
  geom_bar(fill="steelblue")+
  ggtitle("Figure 4. Accidents day by day, 2003") +
  theme_minimal()
```

Figures 3. and 4.shows that Friday is the day with most accidents happened through overall years. So the data of 2003 consistent with the overall data. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tmp %>%
  group_by(hour, wday) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = hour, y=count, color=wday)) + 
  geom_line()+
  ggtitle("Figure 5. Accidents hour by hour, 2003 to 2015")
```

Figure 5 allows us to see both of the times and days of crashes. By the shape of the lines, we predict that the accidents tend to happen in the daytime, starting at 7 am and peaking at 5 pm. Also, evening and night time still have a decent amount of collisions compared to the dawn time. Also, notice that the shapes of these lines look similar to each other.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Month %>%
  group_by(hour, wday) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = hour, y=count, color=wday)) + 
  geom_line()+
  ggtitle("Figure 6. Accidents hour by hour, 2003")


```

Figure 6. has the same function as Figure 5. It shows us the times and days of accidents. Notice that the line represent "Friday" peaked higher than other lines. This is consistent with what we are assuming about the data: Friday has the most severe accidents. 

Let take a look at the tables of frequency accidents below. If we assume that weekdays include: Monday, Tuesday, Wednesday, Thursday, Friday, and weekend have Saturday and Sunday; thus, we have to divide the number of weekday by five and divide the number of the weekend by two. It would be fair if we compare the two mean values rather than the number of observations. 

```{r, error = T, echo=FALSE, message=FALSE, warning=FALSE, results='markup'}
We<-table(tmp$`Weekend?`)
knitr::kable(We)

```

The mean accidents for weekday = 8121.

The mean accidents for weekend = 6636.

We did the same thing for the table frequency 2003 below:

```{r, error = T, echo=FALSE, message=FALSE, warning=FALSE, results='markup'}
We1<-table(Month$`Weekend?`)
knitr::kable(We1)
```

The mean accidents for weekday = 696.

The mean accidents for weekend = 561.

```{r, echo=FALSE, message=FALSE, warning=FALSE}

tmp %>%
  group_by(hour, `Weekend?`, Year) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = hour, y = count, color = `Weekend?`)) + 
  geom_line(aes(frame = Year))+
  ggtitle("Figure 7. Weekend or weekdays?")
```

As 8121 > 6636 and 696 > 561, we conclude that accidents tend to appear on weekdays rather than on the weekend. Figure 7. shows the relationship between hours and weekdays. Notice that the peak is around 5 pm, and so consistent with what we are assuming about the data: Most of the accidents happened in the evening. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tmp %>%
  group_by( `Injury Type`, Month) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count, color = `Injury Type`)) + 
  geom_line()+
  ggtitle("Figure 8. Injury types, 2003 to 2015")

```

Next, we look at the fatal rate. There are four types of injury: Fatal, incapacitating, no injury/ unknown, and non-incapacitating.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Month %>%
  group_by( `Injury Type`, Month) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count, color = `Injury Type`)) + 
  geom_line()+
  ggtitle("Figure 9. Injury types, 2003")

```

Luckily, most of the accidents result in no injury. The number of incapacitating and fatal cases was not high. The data looks consistent for both overall years and 2003 (Figure 8. and Figure 9.).
 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tmp %>%
  group_by(`Collision Type`, Month) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count)) + 
  geom_col() + 
  ggtitle("Figure 10. Collision types, 2003 to 2015") +
  facet_wrap(~`Collision Type`)

```

Figure 10. and Figure 11. tell us about the type of crash: How many vehicles involved? One, two, or three? Can it be the bus? Cyclist? Motorcycle? Pedestrian? 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tmp %>%
  filter(Year == "2003") %>%
  group_by(`Collision Type`, Month) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count)) + 
  geom_col() + 
  ggtitle("Figure 11. Collision types, 2003") +
  facet_wrap(~`Collision Type`)

```

If we look at the overall 2003 to 2015 and look at 2003 only, we see that most of the accidents are the collision between two cars. Notice that the x-axis of the charts represent the months, and we see that the highest column is October, which is consistent with what we are assuming about the data. 

```{r, fig.height=20, fig.width=15, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(tmp, aes(x = fct_rev(fct_infreq(`Primary Factor`)))) + 
  geom_bar()+
  ggtitle("Figure 12. Primary factors of accidents, 2003 to 2015") +
  theme_minimal()+ coord_flip()
```

For the overall years, the primary factor that for most of the accidents is "Failure to yield right of way" (Figure 12.), when the most - second factor is "Following too closely".

```{r, fig.height=20, fig.width=15, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(Month, aes(x = fct_rev(fct_infreq(`Primary Factor`)))) + 
  geom_bar()+
  ggtitle("Figure 13. Primary factors of accidents, 2003") +
  theme_minimal()+ coord_flip()
```
For the year of 2003, "Failure to yield right of way" is still the most factor that lead to accidents (Figure 13.), but the second factor is "Others". So the data of 2003 looks not much consistent to the overall data. 

We can summarize some of the key-words about "trending" accidents in Monroe - county: Most accidents occurred on:

* October (and April).
* Friday, afternoon (around 5 pm). 
* Almost the crashes are between two cars.
* Most of the results is no injury. 
* The primary factor that cause the collisions is Failure to yield right of the way. The most - second factor is Following too closely.

We have look at the year with highest accidents, now we investigate the year with lowest accidents. Recall from Figure 1., we know that years is 2011. We then look at all factors of this year: Month, day, hour, injury type, collision type, and primary factor.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Mo<-filter(tmp, Year == "2011")
ggplot(Mo, aes(x = Month)) + 
  geom_line(stat = "count", aes(y = ..count..))+
  geom_text(aes(Month, 600, label=Month))+
  ggtitle("Figure 14. Accidents month by month, 2011") +
  theme_minimal()
```

In Figure 15., we saw the peaks at October and April. And this is consistent with what we assuming about the overall data. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(Mo, aes(x = wday)) + 
  geom_bar(fill="steelblue")+
  ggtitle("Fig. 15. Accidents day by day, 2011") +
  theme_minimal()
```

It looks like Friday is still the day with the most cases (Figure 16.). The data of 2011 looks consistent with the overall and 2003 data.


```{r, echo=FALSE, message=FALSE, warning=FALSE}

Mo %>%
  group_by(hour, wday) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = hour, y=count, color=wday)) + 
  geom_line()+
  ggtitle("Figure 16. Accidents hour by hour, 2011")

```

Figure 17. show us the time for most of the accidents is afternoon, and it peaking at 4 pm. The 2011 data looks not consistent with what we are assuming about the overall data.


```{r, echo=FALSE, message=FALSE, warning=FALSE}
Mo %>%
  group_by( `Injury Type`, Month) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count, color = `Injury Type`)) + 
  geom_line()+
  ggtitle("Figure 17. Injury types, 2011")

```
Most of the accidents result in no injury (Figure 18.). This is consistent with what we are assuming about the data.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tmp %>%
  filter(Year == "2011") %>%
  group_by(`Collision Type`, Month) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count)) + 
  geom_col() + 
  ggtitle("Figure 18. Collision types, 2011") +
  facet_wrap(~`Collision Type`)

```

Figure 19. let us know that most of the crashes are collisions between two cars.This is consistent with what we are assuming about the data.

```{r, fig.height=20, fig.width=15, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(Mo, aes(x = fct_rev(fct_infreq(`Primary Factor`)))) + 
  geom_bar()+
  ggtitle("Figure 19. Primary factors of accidents, 2011") +
  theme_minimal()+ coord_flip()
```

For 2011, "Failure to yield right of way" is still the most factor that lead to accidents (Figure 19.), when the most - second factor is "Following too closely." It looks like the data is consistent with what we are assuming about the overall data.


## Conclusion




## Sources
[1] https://en.wikipedia.org/wiki/Monroe_County,_Indiana
