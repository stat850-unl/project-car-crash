---
title: "Project Report: Cars Crash"
author: "Huy Ngo"
date: "Fall 2020"
output:
  pagedown::html_paged:
    toc: false
    # change to true for a self-contained document, but it'll be a litte slower for Pandoc to render
    self_contained: false
# uncomment this line to produce HTML and PDF in RStudio:
#knit: pagedown::chrome_print
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F, fig.width = 5, fig.height = 4, out.width = "50%", cache = T)
options(digits = 3)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE} 
library(dplyr)
library(readr)
library(ggplot2)
library(plotly)
library(forcats)
Crash <- read_csv("monroe-county-crash-data2003-to-2015.csv")
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(lubridate)
library(dplyr)
library(stringr)
library(plotly)
tmp <- Crash %>%
  mutate(hm = sprintf("%04d", Hour),
         hour = str_sub(hm, 1, 2) %>% parse_number(),
         minute = str_sub(hm, 3, 4) %>% parse_number()) %>%
  mutate(wday = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")[Day],
         wday_dec = Day + hour/24)
```

## Introduction

Automobiles are an indispensable part of life. Thanks to them that travel, transaction, business, and even medical problems has been improving. But they also carry risks that affect human life. People's need is higher and higher, so the number of vehicles must also increase, which entails many consequences such as traffic congestion and accidents. Every day, with hundreds of millions of car trips moving continuously across the country, the chance that one person might find him/herself get involved in an accident is not small.

Monroe County is part of the Bloomington, Indiana. It was formed in 1818 from portions of Orange County, and named after James Monroe, the fifth President of the United States (in office from 1817 - 1825). The 2010 United States Census report that the population was 137,974, the total area is 411.32 square miles (1,065.3 km2), of which 394.51 square miles (1,021.8 km2) (or 95.91%) is land and 16.81 square miles (43.5 km2) (or 4.09%) is water. The county terrain is low rolling hills, covered with vegetation and largely devoted to agricultural use or urban development. [1] 

The data use in this project is accidents reported in Monroe County from 2003 to 2015. There are more than 53.000 observations (cases reported) and many variables, like:

* Day/ Month/ Year/ Hour (that accidents occurred). 
* Collision type: How many cars involved?  
* What kind of injuries? 
* What is the primary reason that causes accidents to happen?
 

Some questions I want to find out through the data:

  - Which year has the highest rate of accident? On what month? Is that month consistent for all other years? 
  - Is there any specific day (or month, year) with more accidents than the other day (month/ year)? 
  - On that day (month/ year), what is the primary factor that causes the accident? What are the highest injuries? 
  - What can we conclude about driving habit of citizen of Monroe county?
  
## Methods

Comparing the overall with a specific year to find the "trend" of accidents.

* Find the year that has the most accidents occurred. Call it Result. 1
* Among the years, find the month that has the highest accidents. Call it Result. 2
  - Look at the year found in Result. 1, then, find the month has the most accidents. Call it Result. 3. 
  - Compare Result. 3 with Result. 2. 
* Among the years, look at the day with most accidents, identify if it weekday or weekend. Call it Result. 4
  - Look at the Result. 1 and find which type of day has more accidents. Call it Result. 5. 
  - Compare Result. 5 and Result. 4. 
* Among the years, find the hour (in a 24-hour format) with the highest accidents. Call it Result. 6
  - Look at Result. 1 and find which hour has the most accidents. Call it Result. 7
  - Compare Result. 6 and Result. 7. 
* Among the years, look for the primary factor that causes accidents. Call it Result. 8
  - Look at Result. 1 and find the primary factor for accidents. Call it Result. 9
  - Compare Result. 8 and Result. 9. 
* Look at the relationship between all the factors above. Conclude.


## Results

The frequency table below shows us that 2003 was the year with the most accidents: 4625 cases.From now on, we will compare the overall years vs the year 2003.

```{r, error = T, echo=FALSE, message=FALSE, warning=FALSE, results='markup'}
library(ggplot2)
Count<-table(tmp$Year)
knitr::kable(Count)
```

```{r}
tmp %>%
  group_by(Year) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Year, y = count)) + 
  geom_bar(stat="identity", fill="brown") + 
  geom_text(aes(label=count), vjust=1.6, color="white", size=3.5)+
  ggtitle("Figure 1. Which year has the highest accidents?") +
  theme_minimal()
  

```

Look at the overall years (Figure. 2), we see that the clustered point appeared on the top of the graph, indicate that most of the accidents happened in October. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tmp %>%
  group_by(Month, Year) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count, color=Year)) + 
  geom_point()+
  ggtitle("Figure 2. Accidents month by month, 2003 to 2015") 


```

Consider the year 2003 only, we find that October is still the month with most accidents (477 cases - Figure. 3). The data of 2003 looks consistent with the overall data.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Month<-filter(tmp, Year == "2003")
ggplot(Month, aes(x = Month)) + 
  geom_line(stat = "count", aes(y = ..count..))+
  geom_text(aes(Month, 600, label=Month))+
  ggtitle("Figure 3. Accidents month by month, 2003") +
  theme_minimal()
```

Figure 4. shows that Friday is the day with most accidents happened through overall years.

```{r, echo=FALSE, message=FALSE, warning=FALSE}

tmp %>%
  group_by(wday, Year) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = wday, y=count, color=Year)) + 
  geom_point()+
  ggtitle("Figure 4. Accidents day by day, 2003 to 2015")

```

In Figure 5. below, the red dot presents Friday. If we looked at overall months in 2003, we see the red dots appeared much time at the top of the graph, indicate that most of the accidents happened on Friday. So the data of 2003 consistent with the overall data. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Month %>%
  group_by(wday, Month, Year) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y=count, color=wday)) + 
  geom_point()+
  ggtitle("Fig. 5. Accidents day by day, 2003")
```

Next, we look at the hour of accidents. Figure 6. and Figure 7. show us the time for most of the accidents that occurred is 5 pm. The data still consistent. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, figures-side, fig.show="hold", out.width="50%"}
ggplot(tmp, aes(x = hour)) + 
  geom_bar(fill="red")+
  ggtitle("Figure 6. Accidents hour by hour, 2003 to 2015") +
  theme_minimal()

ggplot(Month, aes(x = hour)) + 
  geom_bar(fill="steelblue")+
  ggtitle("Figure 7. Accidents hour by hour, 2003") +
  theme_minimal()

```

From 2003 to 2015, there is a significant difference between the number of accidents on weekdays vs. the weekend (Figure 8.). It looks like accidents tend to appear on weekdays rather than on the weekend.

```{r, echo=FALSE, message=FALSE, warning=FALSE}

tmp %>%
  group_by(hour, `Weekend?`, Year) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = hour, y = count, color = `Weekend?`)) + 
  geom_line(aes(frame = Year))+
  ggtitle("Figure 8. Weekend or weekdays?")
```

Luckily, most of the accidents result in no injury. The number of incapacitating and fatal cases was not high (Figure 9. and Figure 10.).

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(tmp, aes(x = "", fill=`Injury Type`)) + 
  geom_bar()+
  ggtitle("Figure 9. Injury types, 2003 to 2015") +
  theme_minimal()+
  coord_polar("y")
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(Month, aes(x = "", fill=`Injury Type`)) + 
  geom_bar()+
  ggtitle("Figure 10. Injury type, 2003") +
  theme_minimal()+
  coord_polar("y")
```

Figure 11. and Figure 12. let us know that most of the crashes are collisions between two cars. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tmp %>%
  group_by(`Collision Type`, Month) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count)) + 
  geom_col() + 
  ggtitle("Figure 11. Collision types, 2003 to 2015") +
  facet_wrap(~`Collision Type`)

```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
tmp %>%
  filter(Year == "2003") %>%
  group_by(`Collision Type`, Month) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count)) + 
  geom_col() + 
  ggtitle("Figure 12. Collision types, 2003") +
  facet_wrap(~`Collision Type`)

```


For the overall years, the primary factor that for most of the accidents is "Failure to yield right of way" (Figure 13.).

```{r, fig.height=20, fig.width=15, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(tmp, aes(x = fct_rev(fct_infreq(`Primary Factor`)))) + 
  geom_bar()+
  ggtitle("Figure 13. Primary factors of accidents, 2003 to 2015") +
  theme_minimal()+ coord_flip()
```

For the year of 2003, "Failure to yield right of way" is still the most factor that lead to accidents (Figure 14.). It looks like the data is consistent for all of the factors. 

```{r, fig.height=20, fig.width=15, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(Month, aes(x = fct_rev(fct_infreq(`Primary Factor`)))) + 
  geom_bar()+
  ggtitle("Figure 14. Primary factors of accidents, 2003") +
  theme_minimal()+ coord_flip()
```

We can summarize some of the key-words about "trending" accidents in Monroe - county: Most accidents occurred on:

* October.
* Friday afternoon (around 5 pm). 
* Almost the cases is the crash between two cars.
* Most of it results in no injury. 
* The primary factor that cause the collisions is Failure to yield right of the way.

We have look at the year with highest accidents, now we investigate the year with lowest accidents. Recall from Figure 1., we know that years is 2011. We then look at all factors of this year: Month, day, hour, injury type, collision type, and primary factor.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Mo<-filter(tmp, Year == "2011")
ggplot(Mo, aes(x = Month)) + 
  geom_line(stat = "count", aes(y = ..count..))+
  geom_text(aes(Month, 600, label=Month))+
  ggtitle("Figure 15. Accidents month by month, 2011") +
  theme_minimal()
```


Consider 2011, we found that Friday is still the day with the most cases (Figure 16.). The data looks consistent for now. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}

Mo %>%
  group_by(wday, Month, Year) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y=count, color=wday)) + 
  geom_point()+
  ggtitle("Fig. 16. Accidents day by day, 2011")
```

Next, we look at the hour. Figure 17. show us the time for most of the accidents that occurred is 5 pm. The data still consistent. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(Mo, aes(x = hour)) + 
  geom_bar(fill="pink")+
  ggtitle("Figure 17. Accidents hour by hour, 2011") +
  theme_minimal()

```

Luckily, most of the accidents result in no injury. The number of incapacitating and fatal cases was not high (Figure 18.).


```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(Mo, aes(x = "", fill=`Injury Type`)) + 
  geom_bar()+
  ggtitle("Figure 18. Injury type, 2011") +
  theme_minimal()+
  coord_polar("y")
```

Figure 19. let us know that most of the crashes are collisions between two cars. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tmp %>%
  filter(Year == "2011") %>%
  group_by(`Collision Type`, Month) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  ggplot(aes(x = Month, y = count)) + 
  geom_col() + 
  ggtitle("Figure 19. Collision types, 2011") +
  facet_wrap(~`Collision Type`)

```

For 2011, "Failure to yield right of way" is still the most factor that lead to accidents (Figure 20.). It looks like the data is consistent for all of the factors. 
```{r, fig.height=20, fig.width=15, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(Mo, aes(x = fct_rev(fct_infreq(`Primary Factor`)))) + 
  geom_bar()+
  ggtitle("Figure 20. Primary factors of accidents, 2011") +
  theme_minimal()+ coord_flip()
```



## Conclusion




## Source
[1] https://en.wikipedia.org/wiki/Monroe_County,_Indiana